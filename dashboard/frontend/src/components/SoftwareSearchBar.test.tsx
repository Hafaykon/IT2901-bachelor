import { cleanup, fireEvent, render, screen, within } from '@testing-library/react';
import React from 'react';
import SoftwareSearchBar from './SoftwareSeachBar';
import '@testing-library/jest-dom';

const mockSoftware = ['Box [Web]', 'Bang & Olufsen Audio Control 1', 'Spotify 1', 'Guru [Web]', 'Sysinternals Sigcheck 2', 'Uptime Robot [Web]', 'Sysinternals PsGetSid 1', 'Meta Zstandard 1', 'Mozilla Firefox 102', 'Oracle Java SE 8', 'Freedom Scientific ZoomText 2020', 'ShareX 14', 'Canonical Ubuntu [Web]', 'Simon Tatham PSFTP 0.7', 'Microsoft SQL Server 2014 Express LocalDB', 'Don HO Notepad++ 8', 'Microsoft Office 2010 Visio Professional', 'Chocolatey 1.2', 'TeamViewer Management Console [Web]', 'Adobe Bridge CS6', 'Google Drive 68', 'Microsoft Outlook Online [Web]', 'Wireshark Captype 3.6', 'Dell SupportAssist 3', 'Eaton [Web]', 'Xensam Xupervisor [Web]', 'Google Sheets [Web]', 'Polar Flow Sync 3', 'Citrix ICA Client 21', 'Adobe Media Encoder CS6', 'Garmin Express 7', 'Microsoft Photo Story 3', 'Adobe Illustrator 2023', 'LogMeIn LastPass 4', 'Google Drive [Web]', 'Microsoft Edge 98', 'Adobe Acrobat Reader DC', 'Freshworks Freshservice [Web]', 'Microsoft Office 2016 OneNote', 'Confrere [Web]', 'Microsoft Teams', 'Git SCM 2', 'Atlassian Confluence [Web]', 'Microsoft Teams Online [Web]', 'OpenSSL 3', 'Microsoft Remote Desktop Connection Manager 2', 'Atlassian Trello [Web]', 'Microsoft Windows PowerShell 7', 'FSF GNU Patch 2', 'Simon Tatham Pageant 0.7', 'Cisco AnyConnect VPN Client 4.7', 'Google Forms [Web]', 'SourceForge Greenshot 1', 'Sysinternals PsInfo 1', 'Citrix Workspace 22', '8bit Bitwarden [Web]', 'Citrix CEIP 22', 'Microsoft Dynamics 365 Customer Voice [Web]', 'Wireshark Reordercap 3.6', 'Solibri 9.12', 'Mitel MiContact Center 9 Enterprise', 'Google Cloud Platform [Web]', 'Adobe Creative Cloud for Teams', 'Sysinternals DebugView 4', 'Grontmij RoSy 1', 'Insight Macro Express 6 Pro', 'TDF LibreOffice 7.4', 'Sun Java SE Runtime Environment 5', 'Microsoft SQL Server 2014 Express Advanced', 'Google Android Studio 2021', 'Check Point Cyber Security [Web]', 'Google Chrome 108', 'Sysinternals PsFile 1', 'Atlassian JIRA Service Management [Web]', 'Microsoft Office 2016 Standard', 'Microsoft Internet Explorer 11', 'Wireshark Text2pcap 4.0', 'Xensam Xearch 1', 'Microsoft Word Online [Web]', 'Prezi Infogram [Web]', 'iLOQ 5 Series Manager 7', 'Microsoft Visual C++ 2010 Redistributable', 'Microsoft Windows 10 Enterprise', 'NirSoft NirCmd 2', 'Siteimprove [Web]', 'TDF LibreOffice Writer 7.3', 'Sysinternals Streams 1', 'DisplayLink Core Software 9.3', 'Wizkids AppWriter 2', 'Apple Bonjour Print Services 3', 'Microsoft Git Credential Manager For Windows 1', 'Logitech Options 9', 'Postimage [Web]', 'Microsoft OneDrive 19', 'Wireshark Capinfos 3.6', 'Google Chrome Remote Desktop', 'Microsoft Visual C++ 2013 Redistributable', 'Microsoft Office 2016 Excel', 'Tactivos MURAL [Web]', 'Microsoft SQL Server 2019 Database Engine Services', 'PCloud [Web]', 'Microsoft Edge', 'Microsoft PowerToys 0.57', 'Microsoft Windows 365 [Web]', 'HubSpot [Web]', 'TDF LibreOffice 7.3', 'Daniel Stenberg cURL 7', 'Microsoft Office 2016 PowerPoint', 'TDF LibreOffice Writer 7.4', 'Oracle SQL*PLUS 11', 'TechSmith SnagIt 2021', 'Discord 1', 'Microsoft 365 Apps for Enterprise', 'Wireshark Rawshark 3.6', 'Apple Developer [Web]', 'Pdfforge PDFCreator 5.0 Free', 'FSF GNU Bsdtar', 'Microsoft Silverlight 5.1', 'Harmony Hollow The Hat 3', 'Wireshark Text2pcap 3.6', 'ScalePad [Web]', 'Google Android Studio 2020', 'Adobe ExtendScript Toolkit CS6', 'Visma Online [Web]', 'AppNeta [Web]', 'Meetup [Web]', 'Logitech Logi Bolt 1', 'OpenShot Video Editor 2', 'Samsung Smart Switch 4', 'Sysinternals BgInfo 4', 'Sun Java SE JDK 5', 'FSF GNU Privacy Guard 2', 'Monday.com [Web]', 'Atlassian Account [Web]', 'Matterport [Web]', 'Autodesk Material Library 2022', 'Esri ArcGIS for Desktop 10.0', 'Microsoft SQL Server 2017 Express Advanced', 'Joyent Node.js 16', 'Xensam SAM Suite', '8bit Bitwarden 2022', 'GitHub CefSharp 47', 'Google Earth 7', 'Aspiro TIDAL 3', 'Microsoft Office 2016 Visio Viewer', 'Figma 116', 'Wireshark Rawshark 4.0', 'Microsoft PowerToys 0.55', 'Techsoft PixView 7', 'Joyent Node.js 17', 'Microsoft Visual C++ 2015-2019 Redistributable', 'Sysinternals ProcDump 10', 'Chocolatey 0.12', 'Adobe Photoshop Elements 2020', 'Affinity Relationship Intelligence [Web]', 'Wireshark TShark 3', 'Milanote [Web]', 'Don HO WinGUp 5', 'TDF LibreOffice Math 7.4', 'FSF GNU Bzip2 v1', 'Sysinternals Process Explorer 16', 'APSIS Pro [Web]', 'Digia Qmake', 'Gerald Combs AndroidDump', 'Devolutions Remote Desktop Manager 2022 Free', 'TeamViewer 15', 'Microsoft Edge 92', 'Google Sites [Web]', 'Microsoft Edge 106', 'Microsoft Office 2016 Visio Professional', 'VideoLAN VLC Media Player 3', 'Wireshark Dumpcap 4.0', 'Adobe Creative Suite 6 Design Standard', 'Microsoft SQL Server 2014 Management Studio', 'Microsoft Messaging 4', 'Google Chrome 107', 'Microsoft PowerPoint Online [Web]', 'Microsoft SharePoint Online [Web]', 'AutoHotKey 1', 'Oracle Client 19c', 'F.lux 4', 'Wireshark Editcap 3.6', 'GitHub CefSharp 79', 'Tobii Dynavox Communicator 5', 'SendGrid [Web]', 'Oracle Client 12c R2', 'Microsoft Visual Studio 2010 Tools for Office Runtime', 'Gatsby Cloud [Web]', 'AOC Screen+ 1', 'Microsoft PowerToys 0.60', 'TDF LibreOffice Impress 7.4', 'Adobe InDesign CS6', 'Grontmij RoSy MAP 1', 'Simon Tatham Plink 0.7', 'DJI Assistant 2', 'Simon Tatham PuTTY 0.7', 'Autodesk AutoCAD 2022', 'Google Chrome 98', 'Dropbox 162', 'Microsoft Azure DevOps [Web]', 'Skype', 'MyStaff Time Doctor [Web]', 'Valve Steam', 'Oracle Java SE 11 OpenJDK', 'TDF LibreOffice Draw 7.3', 'Adobe Acrobat Reader X', 'Microsoft Windows 10 Pro', 'Citrix CEIP 21', 'Igor Pavlov 7-Zip 19', 'Bruno Xavier SCUE4 v1', 'Paralint Notifu 1', 'Esri MapObjects 2', 'Microsoft Office 2010 Project Standard', 'LingIT LingDys 4', 'Gatsoft Gat 2022', 'Darktable 4', 'Microsoft Office 2016 Word Standalone', 'Microsoft SQL Server 2012 Native Client', 'Oracle Java SE 12 OpenJDK', 'TeamViewer 15 Free', 'Crayon Cloud IQ [Web]', 'Google Gmail [Web]', 'Screencast-O-Matic 2', 'Igor Pavlov 7-Zip 21', 'SuperOffice CRM Online [Web]', 'Microsoft Office Online [Web]', 'SMART Board 12', 'FSF GNU Gettext 0.1', 'Jason Sandys UI++ 3', 'Perfuse Entertainment Golf It!', 'Thomas Koen GeekUninstaller 1', 'Grammarly [Web]', 'ProjectLibre', 'Logitech Options+ 1', 'RealtimeBoard Miro [Web]', 'Microsoft SQL Server 2008 R2 Native Client', 'Softland novaPDF 8', 'Talentwise Refapp [Web]', 'Wireshark Capinfos 4.0', 'Adobe Acrobat DC Standard', 'Microsoft .NET Framework 4.0', 'Upwave [Web]', 'DisplayLink Core Software 9.4', 'GitHub Git Large File Storage 2', 'Adobe Photoshop CS6', 'Riot Games League of Legends', 'Autodesk AutoCAD Map 3D 2022 Network License', 'Bomgar Representative Console 18', 'Adri van Os Antiword', 'Patreon [Web]', 'ClockworkMod Vysor 4', 'Microsoft SQL Server 2017 Express LocalDB', 'ActiveState Tcl 8', 'Google Slides [Web]', 'Sordum PowerRun 1', 'Microsoft Office 2016 Word', 'Microsoft OneDrive Online [Web]', 'Flipper qFlipper 1', 'Pluralsight [Web]', 'Microsoft Account Lockout Status 1', 'Zammad Community [Web]', 'Logitech G HUB 2022', 'SecMaker Net iD 6', 'NVIDIA Control Panel 8', 'Gpg4win 4', 'TDF LibreOffice Calc 7.4', 'Joyent Node.js 14', 'HP Support Assistant 9', 'Citrix Cloud [Web]', 'EasyChair [Web]', 'TDF LibreOffice Impress 7.3', 'Adobe Acrobat Sign [Web]', 'Microsoft Mixed Reality Portal', 'Microsoft To-Do 2', 'Google Chrome 96', 'Adobe Photoshop 2023', 'Martin Prikryl WinSCP 5', 'TechSmith Camtasia 2021', 'Labbed Langlo Designer 3', 'Microsoft Windows 11 Pro', 'Blender 3', 'Escort Data Loggers Console 2 Pro', 'Adobe Premiere Elements 2021', 'TDF LibreOffice Draw 7.4', 'Igor Pavlov 7-Zip 22', 'ReMarkable 2', 'Sysinternals PsLogList 2', 'Aspiro TIDAL 2', 'ServiceNow [Web]', 'Oracle Java SE Runtime Environment 8', 'Okta Identity Cloud [Web]', 'Microsoft OneDrive for Business 2016', 'Microsoft Edge 107', 'Oracle SQL*PLUS 12', 'Python 3.8', 'Adobe Application Manager 10', 'Andy Koppe Mintty 3', 'Adobe DNG Converter 3', 'GIMP 2', 'TechSmith Camtasia 2022', 'Sysinternals PsPasswd 1', 'Bomgar Representative Console 21', 'Anaconda Python 2022', 'Apple iTunes 12', 'FlashForge FlashPrint 5', 'Logitech SetPoint 6', 'SMART Notebook 2', 'Microsoft Visual C++ 2015-2022 Redistributable', 'Wireshark 4.0', 'Microsoft Power BI [Web]', 'Wireshark TShark 4', 'Mozilla Firefox 108', 'Esri ArcGIS for Desktop 10.1', 'TDF LibreOffice Calc 7.3', 'Zwift', 'FileZilla Client 3.62', 'Microsoft Edge 108', 'GitHub [Web]', 'GitHub CefSharp 43', 'OpenSSL 1', 'Python 3.10', 'Citrix RightSignature [Web]', 'Sysinternals PsLoggedOn 1', 'Autodesk ReCap', 'Google Docs [Web]', 'Wireshark Mergecap 3.6', 'DYMO Connect 1', 'Microsoft OneDrive 22', 'Greg Roelofs Info-Zip UnZip 6', 'Avast Secure Browser 108', 'Microsoft Edge 101', 'Sysinternals PsList 1', 'Google Chrome 109', 'Postdot Postman 9', 'Python 3.9', 'Demio [Web]', 'Logitech Unifying Software 2', 'Planview Projectplace [Web]', 'Microsoft Excel Online [Web]', 'TDF LibreOffice Math 7.3', 'Kahoot! [Web]', 'Google Earth 7 Pro', 'Google Go 1.17', 'Apple Bonjour Print Services 2', 'Greg Roelofs Info-Zip Zip 3', 'Oracle Java SE 14 OpenJDK', 'Wireshark Mergecap 4.0', 'SMART Ink 5', 'Google Chrome 97', 'Sysinternals PsService 2', 'Duet Display 2', 'EverNote 10', 'Powel GEMINI VA 5', 'Esri ArcGIS for Developers [Web]', 'Microsoft SQL Server 2019 Express Advanced', 'DotPDN Paint.NET 5', 'Socio [Web]', 'Zoom Meetings 5', 'Microsoft SQL Server 2008 Native Client', 'Oracle TNSPING 11', 'Silhouette Studio 4', 'Wireshark Dumpcap 3.6', 'Sysinternals PsSuspend 1', 'CCB Creditsafe [Web]', 'Bizagi Process Modeler 3', 'Skype 8', 'Adobe Extension Manager CS6', 'Kofax [Web]', 'TDF LibreOffice Base 7.4', 'Adobe Acrobat X Pro', 'Microsoft Office 2016 Access', 'Wireshark 3.6', 'Zotero 5', 'Substack [Web]', 'Joyent Node.js 8', 'Phillip Beauvoir Archi 4', 'Sysinternals PsShutdown 2', 'SpiceBrains Instant EyeDropper 2', 'Adobe Acrobat DC Professional', 'Wireshark Reordercap 4.0', 'Bomgar Representative Console 20', 'IDRIX VeraCrypt 1', 'Esri ArcGIS Engine Runtime 10', 'Helpware.net H2Reg 1', 'Oracle SQL Developer', 'Google Calendar [Web]', 'TDF LibreOffice Base 7.3', 'Microsoft Visual C++ 2012 Redistributable', 'Sysinternals Process Monitor 3', 'Citrix ICA Client 22', 'Autodesk Licensing Service', 'Adobe Premiere Rush 2023', 'WinRAR archiver 6.1', 'Oracle Java SE 8 OpenJDK', 'Microsoft Visual C++ 2005 Redistributable', 'Adobe InDesign 2023', 'BeyondTrust Support Customer Client 21', 'Sindre Sorhus Term-Size 0.1', 'Digia Qmake 5', 'Oracle TNSPING 12', 'Oracle Java SE 9 OpenJDK', 'Microsoft Office 2016 Publisher', 'Simon Tatham PSCP 0.7', 'Conexant SmartAudio 3', 'Oracle VirtualBox 6', 'Google Chrome 105', 'Abilia Rolltalk Designer 10', 'Google Protocol Buffers 3', 'Cisco AnyConnect VPN Client 4.10', 'Oracle Java SE JDK 8', 'Google Chrome 101', 'Sysinternals PsPing 1', 'SourceForge Audacity 3', 'Episerver CMS [Web]', 'Sysinternals PsPing 2', 'Adobe Illustrator CS6', 'GN Jabra Direct 6', 'Blackfish IE Tab 15', 'QSR NVivo 12', 'DBeaver 22', 'JGraph Draw.io 19', 'Microsoft Visual C++ 2008 Redistributable', 'Axure RP 8 Pro', 'Patients Know Best [Web]', 'Microsoft WMI Code Creator 1', 'GitHub Git Large File Storage 3', 'GitHub Desktop Trampoline', 'Microsoft Office 2007 Access Standalone', 'Slack 4', 'GitHub Desktop', 'Bibliotheca RFID 1', 'Oracle Java SE 16 OpenJDK', 'Writelatex Overleaf LaTeX [Web]', 'Atlassian JIRA Ops [Web]', 'Slack [Web]', 'Vivaldi 5', 'Google Chrome 106', 'Oracle Java VisualVM 8', 'Psyonix Rocket Leauge', 'Atlassian Bitbucket [Web]', 'Microsoft Azure Storage Explorer 1', 'Yann Collet LZ4 1', 'FSF GNU Gawk', 'Figma [Web]', 'Snow Inventory 6.7', 'Microsoft Windows Media Player 12', 'NirSoft FullEventLogView 1', 'Wireshark Captype 4.0', 'Microsoft Office 2016 Outlook', 'Microsoft 365 Family', 'Microsoft Visual Studio Code 1', 'Plantronics Hub 3', 'Simon Tatham PuTTYgen 0.7', 'Dmarcian [Web]', 'Microsoft Office 2016 Excel Standalone', 'LogMeIn LastPass [Web]', 'Elgato Stream Deck 5', 'Wireshark Editcap 4.0', 'Respondus LockDown Browser 2', 'Citrix Workspace 21', 'Microsoft Minecraft', 'Thingamahoochie WinMerge 2', 'Recurly [Web]', 'Snyk [Web]', 'QSR NVivo 20', 'Mozilla Firefox 107', 'HP Display Center 1', 'Sysinternals PsExec 2', 'Microsoft OneDrive 21', 'Sysinternals PsKill 1', 'Wireshark 2.2', 'Intel Thunderbolt 17'];


describe('SoftwareSearchBar', () => {
  beforeEach(() => {
    localStorage.setItem('software', JSON.stringify(mockSoftware));
    render(<SoftwareSearchBar />);

  });

  afterEach(() => {
    localStorage.clear();
    cleanup();
  });


  it('renders without crashing', async () => {
    expect(screen.getByLabelText('Søk')).toBeInTheDocument();
    expect(screen.getByTestId('autocomplete-search')).toBeInTheDocument();
  });

  it('can select a software', async () => {
    const autocomplete = screen.getByTestId('autocomplete-search');
    const input = within(autocomplete).getByRole('combobox');
    autocomplete.focus();
    fireEvent.change(input, { target: { value: 'a' } });
    fireEvent.keyDown(autocomplete, { key: 'ArrowDown' });
    fireEvent.keyDown(autocomplete, { key: 'Enter' });
    expect(input).toHaveValue('Box [Web]');
  });
});
